- name: "Include OS-specific tasks"
  include: "os/{{ ansible_distribution }}/main.yml"

- name: install keepalived.conf
  template:
    src: keepalived.conf.j2
    dest: "{{etc_prefix}}/keepalived/keepalived.conf"
  notify: reload keepalived
  tags:
    - keepalived
    - config

- name: install keepalived nginx.cnf
  template:
    src: nginx.cnf.j2
    dest: "{{etc_prefix}}/keepalived/nginx.cnf"
  notify: reload keepalived
  when: has_svc_nginx| default(False)
  tags:
    - keepalived
    - config
    - nginx

- name: install keepalived patroni.cnf
  template:
    src: patroni.cnf.j2
    dest: "{{etc_prefix}}/keepalived/patroni.cnf"
  notify: reload keepalived
  when: groups['svc-patroni'] | count  > 1
  tags:
    - keepalived
    - config
    - patroni

- name: Start keepalived
  service:
    name: keepalived
    state: started
    enabled: yes
  tags:
    - keepalived