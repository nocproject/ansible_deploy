### Package
consul_architecture_map:
  # this first entry seems... redundant (but it's required for reasons)
  amd64: amd64
  x86_64: amd64
  armv7l: arm
  aarch64: arm64
consul_architecture: "{{ consul_architecture_map[ansible_architecture] }}"
consul_os: "{{ ansible_system|lower }}"
consul_pkg: "consul_{{ consul_version }}_{{ consul_os }}_{{ consul_architecture }}.zip"
consul_zip_url: "https://releases.hashicorp.com/consul/{{ consul_version }}/consul_{{ consul_version }}_{{ consul_os }}_{{ consul_architecture }}.zip"
consul_checksum_file_url: "https://releases.hashicorp.com/consul/{{ consul_version }}/consul_{{ consul_version}}_SHA256SUMS"

### Paths
consul_bin_path: "/bin"
consul_config_path: "{{etc_prefix}}/consul"
consul_configd_path: "{{etc_prefix}}/consul.d"
consul_data_path: "/var/consul"
consul_log_path: "/var/log/consul"

### System user and group
consul_manage_user: yes
consul_user: "consul"
consul_group: "bin"

### Consul settings
consul_datacenter: "{{noc_env}}"
consul_domain: "consul"
consul_log_level: "INFO"
consul_syslog_enable: "True"
consul_iface: "{{ ansible_default_ipv4.interface}}"
consul_node_name: "{{ inventory_hostname_short }}"
consul_recursors: ["{{tower_ip}}"]
consul_node_role: "{% if has_svc_consul_server is defined%}bootstrap{% elif has_svc_consul is defined %}server{% else %}client{%endif%}"
consul_raw_key: "{{ lookup('consul_key', tower_data + '/consul/secret.key') }}"

### Addresses
consul_bind_address: "\
  {% if ansible_system == 'FreeBSD' %}\
    {{ lookup('env','CONSUL_BIND_ADDRESS') | default(hostvars[inventory_hostname]['ansible_'+ consul_iface ]['ipv4'][0]['address'], true) }}\
  {% else %}\
    {{ lookup('env','CONSUL_BIND_ADDRESS') | default(hostvars[inventory_hostname]['ansible_'+ consul_iface ]['ipv4']['address'], true) }}\
  {% endif %}"
consul_dns_bind_address: "127.0.0.1"
consul_http_bind_address: "0.0.0.0"
consul_https_bind_address: "0.0.0.0"
consul_rpc_bind_address: "0.0.0.0"
consul_vault_address: "{{ vault_address | default('0.0.0.0', true) }}"

### Ports
consul_ports:
  rpc: 8400
  http: 8500
  https: -1
  dns: 8600

### Servers
consul_servers: "\
  {% set _consul_servers = [] %}\
  {% for host in groups[has_svc_consul] %}\
    {% set _consul_node_role = hostvars[host]['consul_node_role']|default('client', true) %}\
    {% if ( _consul_node_role == 'server' or _consul_node_role == 'bootstrap') %}\
      {% if _consul_servers.append(host) %}{% endif %}\
    {% endif %}\
  {% endfor %}\
  {{ _consul_servers }}"
consul_gather_server_facts: no

## ACL
consul_acl_enable: True
consul_acl_datacenter: "{{noc_env}}"
consul_acl_default_policy: "allow"
consul_acl_down_policy: "allow"
consul_acl_master_token_display: False
consul_acl_replication_token_display: False