
- name: Check if custom exists on old path
  stat:
    path: "{{noc_root}}/custom"
  register: old_path
  tags:
    - mercurial
    - custom

- name: move custom to new location
  shell: mv "{{noc_root}}/custom/" "{{noc_root | dirname}}/noc_custom/"
  when: old_path.stat.exists is defined and old_path.stat.exists
  tags:
    - mercurial
    - custom

- name: make symlink for old dir
  file:
    src: "{{noc_root | dirname}}/noc_custom/"
    dest: "{{noc_root}}/custom"
    state: link
  when: old_path.stat.exists is defined and old_path.stat.exists
  tags:
    - mercurial
    - custom