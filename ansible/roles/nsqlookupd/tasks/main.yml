---
- name: include nsqlookupd os specific tasks
  include: "os/{{ ansible_distribution }}/main.yml"

- name: Install nsqlookupd monitoring
  template:
    src: "etc/telegraf/telegraf.d/nsqlookupd.conf.j2"
    dest: "{{etc_prefix}}/telegraf/telegraf.d/nsqlookupd.conf"
  notify: reload telegraf
  tags:
    - config
    - telegraf

- name: install nsqlookupd config
  template:
    src: config/nsqlookupd.conf.j2
    dest: "{{noc_root}}/var/etc/nsq/nsqlookupd.conf"
  notify: restart nsqlookupd
  tags:
    - config

- name: Enable nsqlookupd system service
  service:
    name: "nsqlookupd"
    enabled: yes
    state: started

- name: copy nsqlookupd consul templates
  template:
    src: nsqlookupd.json
    dest: "{{consul_configd_path}}"
  notify: reload consul
  tags:
    - consul