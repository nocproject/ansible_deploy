- block:
  - name: install nginx upstream template
    copy:
      src: upstream.conf.ctmpl
      dest: "{{ consul_template_templates_dir }}/upstream.conf.ctmpl"
    notify: reload consul-template

  - name: install nginx upstream config for template
    template:
      src: services/upstream.conf.j2
      dest: "{{consul_template_config_dir}}/upstream.conf"
    notify: reload consul-template
  when: has_svc_nginx is defined

- name: install nsqd config for template
  template:
    src: "{{item.src}}"
    dest: "{{item.dest}}"
  notify: reload consul-template
  with_items:
    - src: services/nsqd.conf.j2
      dest: "{{consul_template_config_dir}}/nsqd.conf"
    - src: services/nsqd.conf.ctmpl
      dest: "{{ consul_template_templates_dir }}/nsqd.conf.ctmpl"
  when: has_svc_nsqd is defined

- name: install nsqadmin config for template
  template:
    src: "{{item.src}}"
    dest: "{{item.dest}}"
  notify: reload consul-template
  with_items:
    - src: services/nsqadmin.conf.j2
      dest: "{{consul_template_config_dir}}/nsqadmin.conf"
    - src: services/nsqadmin.conf.ctmpl
      dest: "{{ consul_template_templates_dir }}/nsqadmin.conf.ctmpl"
  when: has_svc_nsqadmin is defined

