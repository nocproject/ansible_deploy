- block:
  - name: install nginx upstream template
    copy:
      src: upstream.conf.ctmpl
      dest: "{{ consul_template_templates_dir }}/upstream.conf.ctmpl"
    notify: reload consul-template

  - name: install nginx upstream config for template
    template:
      src: services/upstream.conf.j2
      dest: "{{consul_template_config_dir}}/upstream.conf"
    notify: reload consul-template
  when: ansible_nodename in groups['svc-nginx']

- block:
  - name: install noc_activator template
    copy:
      src: noc_activator.ctmpl
      dest: "{{ consul_template_templates_dir }}/noc_activator.ctmpl"
    notify: reload consul-template

  - name: install noc_activator config for template
    template:
      src: services/noc_activator.conf.j2
      dest: "{{consul_template_config_dir}}/noc_activator.conf"
    notify: reload consul-template
  when: ansible_nodename in groups['svc-activator'] and telegraf_influxdb_enabled

- block:
  - name: install noc_bi template
    copy:
      src: noc_bi.ctmpl
      dest: "{{ consul_template_templates_dir }}/noc_bi.ctmpl"
    notify: reload consul-template

  - name: install noc_bi config for template
    template:
      src: services/noc_bi.conf.j2
      dest: "{{consul_template_config_dir}}/noc_bi.conf"
    notify: reload consul-template
  when: ansible_nodename in groups['svc-bi'] and telegraf_influxdb_enabled

- block:
  - name: install noc_chwriter template
    copy:
      src: noc_chwriter.ctmpl
      dest: "{{ consul_template_templates_dir }}/noc_chwriter.ctmpl"
    notify: reload consul-template

  - name: install noc_chwriter config for template
    template:
      src: services/noc_chwriter.conf.j2
      dest: "{{consul_template_config_dir}}/noc_chwriter.conf"
    notify: reload consul-template
  when: ansible_nodename in groups['svc-chwriter'] and telegraf_influxdb_enabled

- block:
  - name: install noc_card template
    copy:
      src: noc_card.ctmpl
      dest: "{{ consul_template_templates_dir }}/noc_card.ctmpl"
    notify: reload consul-template

  - name: install noc_card config for template
    template:
      src: services/noc_card.conf.j2
      dest: "{{consul_template_config_dir}}/noc_card.conf"
    notify: reload consul-template
  when: ansible_nodename in groups['svc-card'] and telegraf_influxdb_enabled

- block:
  - name: install noc_classifier template
    copy:
      src: noc_classifier.ctmpl
      dest: "{{ consul_template_templates_dir }}/noc_classifier.ctmpl"
    notify: reload consul-template

  - name: install noc_classifier config for template
    template:
      src: services/noc_classifier.conf.j2
      dest: "{{consul_template_config_dir}}/noc_classifier.conf"
    notify: reload consul-template
  when: ansible_nodename in groups['svc-classifier'] and telegraf_influxdb_enabled

- block:
  - name: install noc_correlator template
    copy:
      src: noc_correlator.ctmpl
      dest: "{{ consul_template_templates_dir }}/noc_correlator.ctmpl"
    notify: reload consul-template

  - name: install noc_correlator config for template
    template:
      src: services/noc_correlator.conf.j2
      dest: "{{consul_template_config_dir}}/noc_correlator.conf"
    notify: reload consul-template
  when: ansible_nodename in groups['svc-correlator'] and telegraf_influxdb_enabled

- block:
  - name: install noc_discovery template
    copy:
      src: noc_discovery.ctmpl
      dest: "{{ consul_template_templates_dir }}/noc_discovery.ctmpl"
    notify: reload consul-template

  - name: install noc_discovery config for template
    template:
      src: services/noc_discovery.conf.j2
      dest: "{{consul_template_config_dir}}/noc_discovery.conf"
    notify: reload consul-template
  when: ansible_nodename in groups['svc-discovery'] and telegraf_influxdb_enabled

- block:
  - name: install noc_escalator template
    copy:
      src: noc_escalator.ctmpl
      dest: "{{ consul_template_templates_dir }}/noc_escalator.ctmpl"
    notify: reload consul-template

  - name: install noc_escalator config for template
    template:
      src: services/noc_escalator.conf.j2
      dest: "{{consul_template_config_dir}}/noc_escalator.conf"
    notify: reload consul-template
  when: ansible_nodename in groups['svc-escalator'] and telegraf_influxdb_enabled

- block:
  - name: install noc_grafanads template
    copy:
      src: noc_grafanads.ctmpl
      dest: "{{ consul_template_templates_dir }}/noc_grafanads.ctmpl"
    notify: reload consul-template

  - name: install noc_grafanads config for template
    template:
      src: services/noc_grafanads.conf.j2
      dest: "{{consul_template_config_dir}}/noc_grafanads.conf"
    notify: reload consul-template
  when: ansible_nodename in groups['svc-grafanads'] and telegraf_influxdb_enabled

- block:
  - name: install noc_login template
    copy:
      src: noc_login.ctmpl
      dest: "{{ consul_template_templates_dir }}/noc_login.ctmpl"
    notify: reload consul-template

  - name: install noc_login config for template
    template:
      src: services/noc_login.conf.j2
      dest: "{{consul_template_config_dir}}/noc_login.conf"
    notify: reload consul-template
  when: ansible_nodename in groups['svc-login'] and telegraf_influxdb_enabled

- block:
  - name: install noc_mailsender template
    copy:
      src: noc_mailsender.ctmpl
      dest: "{{ consul_template_templates_dir }}/noc_mailsender.ctmpl"
    notify: reload consul-template

  - name: install noc_mailsender config for template
    template:
      src: services/noc_mailsender.conf.j2
      dest: "{{consul_template_config_dir}}/noc_mailsender.conf"
    notify: reload consul-template
  when: ansible_nodename in groups['svc-mailsender'] and telegraf_influxdb_enabled

- block:
  - name: install noc_mrt template
    copy:
      src: noc_mrt.ctmpl
      dest: "{{ consul_template_templates_dir }}/noc_mrt.ctmpl"
    notify: reload consul-template

  - name: install noc_mrt config for template
    template:
      src: services/noc_mrt.conf.j2
      dest: "{{consul_template_config_dir}}/noc_mrt.conf"
    notify: reload consul-template
  when: ansible_nodename in groups['svc-mrt'] and telegraf_influxdb_enabled

- block:
  - name: install noc_omap template
    copy:
      src: noc_omap.ctmpl
      dest: "{{ consul_template_templates_dir }}/noc_omap.ctmpl"
    notify: reload consul-template

  - name: install noc_omap config for template
    template:
      src: services/noc_omap.conf.j2
      dest: "{{consul_template_config_dir}}/noc_omap.conf"
    notify: reload consul-template
  when: ansible_nodename in groups['svc-omap'] and telegraf_influxdb_enabled

- block:
  - name: install noc_ping template
    copy:
      src: noc_ping.ctmpl
      dest: "{{ consul_template_templates_dir }}/noc_ping.ctmpl"
    notify: reload consul-template

  - name: install noc_ping config for template
    template:
      src: services/noc_ping.conf.j2
      dest: "{{consul_template_config_dir}}/noc_ping.conf"
    notify: reload consul-template
  when: ansible_nodename in groups['svc-ping'] and telegraf_influxdb_enabled

- block:
  - name: install noc_pmwriter template
    copy:
      src: noc_pmwriter.ctmpl
      dest: "{{ consul_template_templates_dir }}/noc_pmwriter.ctmpl"
    notify: reload consul-template

  - name: install noc_pmwriter config for template
    template:
      src: services/noc_pmwriter.conf.j2
      dest: "{{consul_template_config_dir}}/noc_pmwriter.conf"
    notify: reload consul-template
  when: ansible_nodename in groups['svc-pmwriter'] and telegraf_influxdb_enabled

- block:
  - name: install noc_sae template
    copy:
      src: noc_sae.ctmpl
      dest: "{{ consul_template_templates_dir }}/noc_sae.ctmpl"
    notify: reload consul-template

  - name: install noc_sae config for template
    template:
      src: services/noc_sae.conf.j2
      dest: "{{consul_template_config_dir}}/noc_sae.conf"
    notify: reload consul-template
  when: ansible_nodename in groups['svc-sae'] and telegraf_influxdb_enabled

- block:
  - name: install noc_scheduler template
    copy:
      src: noc_scheduler.ctmpl
      dest: "{{ consul_template_templates_dir }}/noc_scheduler.ctmpl"
    notify: reload consul-template

  - name: install noc_scheduler config for template
    template:
      src: services/noc_scheduler.conf.j2
      dest: "{{consul_template_config_dir}}/noc_scheduler.conf"
    notify: reload consul-template
  when: ansible_nodename in groups['svc-scheduler'] and telegraf_influxdb_enabled

- block:
  - name: install noc_syslogcollector template
    copy:
      src: noc_syslogcollector.ctmpl
      dest: "{{ consul_template_templates_dir }}/noc_syslogcollector.ctmpl"
    notify: reload consul-template

  - name: install noc_syslogcollector config for template
    template:
      src: services/noc_syslogcollector.conf.j2
      dest: "{{consul_template_config_dir}}/noc_syslogcollector.conf"
    notify: reload consul-template
  when: ansible_nodename in groups['svc-syslogcollector'] and telegraf_influxdb_enabled

- block:
  - name: install noc_trapcollector template
    copy:
      src: noc_trapcollector.ctmpl
      dest: "{{ consul_template_templates_dir }}/noc_trapcollector.ctmpl"
    notify: reload consul-template

  - name: install noc_trapcollector config for template
    template:
      src: services/noc_trapcollector.conf.j2
      dest: "{{consul_template_config_dir}}/noc_trapcollector.conf"
    notify: reload consul-template
  when: ansible_nodename in groups['svc-trapcollector'] and telegraf_influxdb_enabled

- block:
  - name: install noc_web template
    copy:
      src: noc_web.ctmpl
      dest: "{{ consul_template_templates_dir }}/noc_web.ctmpl"
    notify: reload consul-template

  - name: install noc_web config for template
    template:
      src: services/noc_web.conf.j2
      dest: "{{consul_template_config_dir}}/noc_web.conf"
    notify: reload consul-template
  when: ansible_nodename in groups['svc-web'] and telegraf_influxdb_enabled

- block:
  - name: install noc_tgsender template
    copy:
      src: noc_tgsender.ctmpl
      dest: "{{ consul_template_templates_dir }}/noc_tgsender.ctmpl"
    notify: reload consul-template

  - name: install noc_tgsender config for template
    template:
      src: services/noc_tgsender.conf.j2
      dest: "{{consul_template_config_dir}}/noc_tgsender.conf"
    notify: reload consul-template
  when: ansible_nodename in groups['svc-tgsender'] and telegraf_influxdb_enabled

- name: install nsqd config for template
  template:
    src: "{{item.src}}"
    dest: "{{item.dest}}"
  notify: reload consul-template
  with_items:
    - src: services/nsqd.conf.j2
      dest: "{{consul_template_config_dir}}/nsqd.conf"
    - src: services/nsqd.conf.ctmpl
      dest: "{{ consul_template_templates_dir }}/nsqd.conf.ctmpl"
  when: ansible_nodename in groups['svc-nsqd']

- name: install nsqadmin config for template
  template:
    src: "{{item.src}}"
    dest: "{{item.dest}}"
  notify: reload consul-template
  with_items:
    - src: services/nsqadmin.conf.j2
      dest: "{{consul_template_config_dir}}/nsqadmin.conf"
    - src: services/nsqadmin.conf.ctmpl
      dest: "{{ consul_template_templates_dir }}/nsqadmin.conf.ctmpl"
  when: ansible_nodename in groups['svc-nsqadmin']