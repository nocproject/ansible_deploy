---

- name: download nsq daemon
  get_url:
    url: https://s3.amazonaws.com/bitly-downloads/nsq/nsq-{{nsq_version}}.{{ansible_system.lower()}}-amd64.go1.6.2.tar.gz
    dest: /tmp/nsq-{{nsq_version}}.{{ansible_system.lower()}}-amd64.go1.6.2.tar.gz
    validate_certs: no
  when: nsqd_binary.stat.isfile is not defined and nsq_version_is_ok is not defined
  environment:
    https_proxy: "{{http_proxy}}"

- name: install nsq on FreeBSD
  command: /usr/bin/tar --strip-components=1 -xf /tmp/nsq-{{nsq_version}}.{{ansible_system.lower()}}-amd64.go1.6.2.tar.gz -C {{ noc_root }}
  when: nsqd_binary.stat.isfile is not defined and nsq_version_is_ok is not defined

- name: Install nsqd init script
  template: src="os/FreeBSD/etc/rc.d/nsqd.j2" dest="/usr/local/etc/rc.d/nsqd" mode="a+rx"

- name: Enable NSQD system service
  service: name="nsqd" enabled=yes
