- name: Install noc.pth
  template:
    src: "lib/python/site-packages/noc.pth.j2"
    dest: "{{noc_root}}/lib/python/site-packages/noc.pth"

- name: Check sitecustomize
  stat: path="{{noc_root}}/lib/python/site-packages/sitecustomize.py"
  register: sitecustomizes
  tags:
    - config

- name: Install sitecustomize.py
  template:
    src: "lib/python/site-packages/sitecustomize.py.j2"
    dest: "{{noc_root}}/lib/python/site-packages/sitecustomize.py"
  when: sitecustomizes.stat.exists == False
  tags:
    - config

- name: Update site.py
  replace:
    dest: "{{noc_root}}/lib/python/site.py"
    regexp: "encoding = 'ascii'"
    replace: "encoding = 'utf-8'"
  when: sitecustomizes.stat.exists == True


- name: Tune sysctl.conf for node
  sysctl:
    name: "{{item.name}}"
    value: "{{item.value}}"
    state: present
    reload: yes
  with_items:
    - { name: 'net.ipv4.ip_local_port_range', value: '20024 65000'}
  tags:
    - config
  when: "'Linux' in ansible_system"

- name: patch supervisord for oomkiller
  patch:
    basedir: "{{noc_root}}"
    src: oom_score_adj.patch
    strip: 1
  tags:
    - config
  when: "'Linux' in ansible_system and 'prod' in noc_env_type"

