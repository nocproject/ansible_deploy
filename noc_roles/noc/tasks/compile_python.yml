---
- name: "Fail if Python version for download is not recommended"
  fail:
    msg: |
      In case if system doesn't have Python of chosen version {{ noc_py3_ver }},
      we recommend use last supported for that release: https://getnoc.com/blog/
  when: noc_py3_ver == "3.7"

- name: "Python{{ noc_py3_ver }} | Download precompiled archive"
  get_url:
    url: "noc_python_url"
    dest: "{{ tower_dist_dir }}/Python-{{ py_version['py' ~ noc_py3_ver] }}.tar.xz"
    #checksum: "md5:{{ py_hashes['py' ~ noc_py3_ver] }}"
  delegate_to: 127.0.0.1
  environment:
    https_proxy: "{{ http_proxy }}"
    http_proxy: "{{ http_proxy }}"

- name: "Python{{ noc_py3_ver }} | Create dir for extracting"
  file:
    path: "/opt/python{{ noc_py3_ver }}"
    state: directory

- name: "Python{{ noc_py3_ver }} | Uncompress"
  unarchive:
    src: "{{ tower_dist_dir }}/Python-{{ py_version['py' ~ noc_py3_ver] }}.tar.xz"
    dest: "/opt/python{{ noc_py3_ver }}/"
    creates: "/opt/python{{ noc_py3_ver }}/Python-{{ py_version['py' ~ noc_py3_ver] }}"

- name: Take path for new python3
  set_fact:
    noc_init_python_path: "/opt/python{{ noc_py3_ver }}/bin/python{{ noc_py3_ver }}"
