---
- name: Install FreeBSD system packages
  pkgng:
    name: "{{ packages }}"
    state: present
  vars:
    packages:
      - postgresql{{ postgres_version|replace(".","") }}-client
      - python2
      - py27-virtualenv
      - curl
      - libffi
      - libmemcached
      - git
      - zstd
  tags:
    - requirements
  register: freebsd_pkg_result
  retries: 4
  delay: 2
  until: freebsd_pkg_result is succeeded

- name: Create symlink for virtualenv
  file:
    src: /usr/local/bin/virtualenv-2.7
    dest: /usr/local/bin/virtualenv
    owner: root
    group: wheel
    mode: '0755'
    state: link
  tags:
    - requirements

- name: Install supervisord init script
  template:
    src: "os/FreeBSD/etc/rc.d/noc.j2"
    dest: "/usr/local/etc/rc.d/{{ noc_system_service }}"
    mode: "a+rx"
