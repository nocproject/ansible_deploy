---
- name: Install Debian consul depends
  apt:
    name: "{{item}}"
    update_cache: "True"
    cache_valid_time: "{{apt_cache_valid_time | default (3600)}}"
  with_items:
    - python-virtualenv
  environment:
    https_proxy: "{{http_proxy}}"
    http_proxy: "{{http_proxy}}"
  tags:
    - requirements

- name: systemd script
  template:
    src: consul_systemd.service.j2
    dest: /lib/systemd/system/consul.service
    owner: root
    group: root
    mode: 0644
  tags:
    - config
  notify:
    - reload systemd
    - restart consul

- name: Expose consul_bind_address as fact
  set_fact:
    consul_bind_address: "{{ansible_host}}"
  when: consul_address is defined and consul_address!='node_ip'
  tags:
    - config
