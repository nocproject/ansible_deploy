---
- name: download nsq daemon
  get_url:
    url: https://s3.amazonaws.com/bitly-downloads/nsq/nsq-{{nsq_version}}.{{ansible_system.lower()}}-amd64.go1.6.2.tar.gz
    dest: /tmp/nsq-{{nsq_version}}.{{ansible_system.lower()}}-amd64.go1.6.2.tar.gz
    validate_certs: yes
  environment:
    https_proxy: "{{http_proxy}}"

- name: unanchive nsqd
  unarchive:
    src: "{{nsq_temp_file}}"
    dest: "{{nsq_root}}"
    extra_opts: ['--strip-components=2']
    creates: "{{nsq_root}}/nsqlookupd"

- name: Install nsqlookupd init script
  template: src="os/FreeBSD/etc/rc.d/nsqlookupd.j2" dest="/usr/local/etc/rc.d/nsqlookupd" mode="a+rx"

- name: Enable nsqlookupd system service
  service: name="nsqlookupd" enabled=yes
