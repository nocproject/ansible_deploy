- name: fail if consul-template is not selected
  fail:
    msg: "Clickhouse role have to be set along with consul-template role to get access to noc ch_datasource service."
  when:
    - has_svc_clickhouse is defined
    - has_svc_consul_template is not defined

- name: fail if consul is not selected
  fail:
    msg: "Clickhouse role have to be set along with consul role to get access to noc ch_datasource service."
  when:
    - has_svc_clickhouse is defined
    - has_svc_consul is not defined

- name: fail if too many clickhouses selected
  fail:
    msg: "Too many clickhouse servers selected and HA setup is not selected. Remove some servers or setup HA"
  when:
    - has_svc_clickhouse is defined
    - groups['svc-clickhouse-exec'] | length > 1
    - "'svc-ha-clickhouse-exec' not in groups"