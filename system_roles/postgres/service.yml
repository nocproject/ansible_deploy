- name: Install and configure postgres
  hosts: svc-postgres-exec
  become: yes
  serial: 1
  any_errors_fatal: true
  tags:
    - postgres
    - external
  vars_files:
    - "../../vars/main.yml"
    - "../../vars/{{ ansible_distribution }}.yml"
  pre_tasks:
    - name: set postgres master
      add_host:
        name: "{{ inventory_hostname }}"
        groups: svc-postgres-master
      when: '"master" in postgres_power'
  roles:
    - role: postgres
  post_tasks:
    - name: set postgres complete
      set_fact:
        postgres_complete: True