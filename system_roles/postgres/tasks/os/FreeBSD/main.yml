---
- name: "Install PostgreSQL 1/2"
  pkgng:
    name: "{{item}}"
    state: present
  with_items:
    - 'postgresql{{postgres_version|replace(".","")}}-server'


- name: "Install PostgreSQL 2/2"
  pkgng:
    name: "{{item}}"
    state: present
  with_items:
    - 'py27-psycopg2'
    - 'postgresql{{postgres_version|replace(".","")}}-contrib'

- name: Enable postgres system service
  service:
    name: "{{postgres_system_service}}"
    enabled: "True"

- name: PostgreSQL init db
  command: service postgresql initdb
  args:
    creates: "{{ postgresql_hba_path }}"

- name: Starting PostgreSQL service
  # This avoid this message:
  # pg_ctl: could not read file "/usr/local/pgsql/data/postmaster.opts"
  command: service postgresql start
  args:
    creates: /usr/local/pgsql/data/postmaster.opts
